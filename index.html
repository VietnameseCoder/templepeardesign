<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Templepear - A hyper-creative digital agency crafting fearless, immersive WebGL experiences and uncompromising design.">
    <meta name="theme-color" content="#050505">
    <title>Templepear Web Design üçê</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        display: ['Syne', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#050505',
                            light: '#f4f4f0',
                            accent: '#dfff00',
                            pear: '#b5cc18'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        html.lenis, html.lenis body { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto !important; }
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; }
        .lenis.lenis-stopped { overflow: hidden; }
        .lenis.lenis-smooth iframe { pointer-events: none; }
        
        body {
            background-color: #050505;
            color: #f4f4f0;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { display: none; }

        /* Accessibility: Strict Focus States */
        a:focus-visible, button:focus-visible, [tabindex]:focus-visible {
            outline: 3px solid #dfff00;
            outline-offset: 6px;
            border-radius: 2px;
        }

        #webgl-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
        }

        #content {
            position: relative;
            z-index: 10;
        }

        .char {
            display: inline-block;
            will-change: transform, opacity;
        }
        
        /* Performance: Reduced shadow blur radiuses to prevent expensive paint operations on scroll */
        .text-outline {
            color: rgba(244, 244, 240, 0.12);
            -webkit-text-stroke: max(2.5px, 0.35vw) #f4f4f0;
            text-shadow: 4px 4px 0px #050505, 0 8px 20px rgba(5, 5, 5, 0.8);
        }

        .text-solid-shadow {
            text-shadow: 4px 4px 0px #050505, 0 4px 15px rgba(5, 5, 5, 0.8);
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 999;
            opacity: 0.04;
            background: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)"/%3E%3C/svg%3E');
        }

        #cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 12px;
            height: 12px;
            background: #dfff00;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            /* Performance: Removed transform transition, relying fully on highly optimized GSAP quickTo */
            transition: width 0.3s, height 0.3s, background 0.3s, border 0.3s;
            mix-blend-mode: difference;
            display: flex;
            justify-content: center;
            align-items: center;
            will-change: transform;
        }
        #cursor::after {
            content: attr(data-text);
            position: absolute;
            font-size: 10px;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: bold;
            color: #050505;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        #cursor.hover {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid #dfff00;
        }
        #cursor.scroll-state {
            width: 80px;
            height: 80px;
            background: #f4f4f0;
            border: none;
            mix-blend-mode: normal;
        }
        #cursor.scroll-state::after {
            opacity: 1;
            content: "SCROLL";
        }
        
        .value-title {
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            white-space: nowrap !important;
            word-break: keep-all !important;
            overflow-wrap: normal !important;
            display: block;
        }
        .value-desc {
            transition: opacity 0.6s, transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateY(20px);
        }
        .hover-trigger:hover .value-title {
            transform: translateY(-10px);
        }
        .hover-trigger:hover .value-desc {
            opacity: 1;
            transform: translateY(0);
        }
        
        .magnetic-btn {
            will-change: transform;
        }

        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #050505;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        #pear-loader-svg {
            filter: drop-shadow(0 0 15px rgba(223, 255, 0, 0.3));
        }

        .fluid-hero {
            font-size: clamp(2.5rem, 15vw, 15rem);
            line-height: 0.85;
            width: 100%;
            text-align: center;
            white-space: nowrap;
        }
        .fluid-value {
            font-size: clamp(2rem, 8.5vw, 11rem);
            line-height: 0.9;
        }

        @media (max-width: 640px) {
            .fluid-value {
                font-size: clamp(1.8rem, 12vw, 4rem);
            }
        }
        
        @media (max-width: 380px) {
            .fluid-value {
                font-size: 14vw;
            }
        }
    </style>
</head>
<body>

    <div class="noise" aria-hidden="true"></div>
    <div id="cursor" aria-hidden="true"></div>

    <div id="loader" role="alert" aria-busy="true" aria-label="Loading Templepear Experience">
        <svg id="pear-loader-svg" aria-hidden="true" viewBox="0 0 100 120" class="w-24 h-24 md:w-32 md:h-32 stroke-brand-accent fill-transparent" style="stroke-width: 3px; stroke-linecap: round; stroke-linejoin: round;">
            <path id="pear-loader-path" d="M 60 10 C 55 5, 50 10, 50 20 C 35 20, 20 40, 15 70 C 10 95, 30 115, 50 115 C 70 115, 90 95, 85 70 C 80 40, 65 20, 50 20" />
        </svg>
    </div>

    <div id="webgl-container" aria-hidden="true"></div>

    <main id="smooth-wrapper">
        <div id="smooth-content" id="content">
            
            <header class="fixed top-0 left-0 w-full p-6 md:p-8 flex justify-between items-center z-50 mix-blend-difference text-white pointer-events-none">
                <div class="font-display font-bold text-lg md:text-xl tracking-wider uppercase pointer-events-auto cursor-hover" tabindex="0">TEMPLEPEAR&copy;</div>
            </header>

            <section class="h-screen w-full flex flex-col justify-center items-center relative mix-blend-difference px-4" id="section-hero">
                <div class="flex flex-col justify-center items-center w-full max-w-[100vw] overflow-hidden">
                    <h1 class="sr-only">Temple Pear</h1>
                    <div aria-hidden="true" class="font-display font-bold uppercase split-target fluid-hero text-solid-shadow">
                        TEMPLE
                    </div>
                    <div aria-hidden="true" class="font-display font-bold uppercase text-outline split-target fluid-hero z-10 relative">
                        PEAR
                    </div>
                </div>
                <div class="absolute bottom-10 left-6 md:left-10 text-[10px] md:text-xs tracking-widest uppercase text-white/50" aria-hidden="true">
                    <p>Scroll to explore.</p>
                </div>
            </section>

            <section class="min-h-screen w-full flex items-center p-6 md:p-20 relative mix-blend-difference" id="section-about">
                <div class="w-full md:w-1/2">
                    <h2 class="font-display text-4xl md:text-7xl font-bold uppercase leading-tight mb-8 section-2-text">
                        We shape<br>experiences.
                    </h2>
                    <p class="text-base md:text-xl font-light max-w-md text-white/90 leading-relaxed section-2-fade">
                        Templepear is a web design agency based on creativity. We use WebGL, advanced motion physics, and uncompromising typography to build digital platforms that leave a lasting impact.
                    </p>
                </div>
            </section>

            <section class="min-h-screen w-full flex items-center justify-end p-6 md:p-20 relative mix-blend-difference" id="section-services">
                <div class="w-full md:w-1/2 text-right">
                    <h2 class="font-display text-4xl md:text-7xl font-bold uppercase leading-none text-brand-accent section-3-text">
                        The Core.
                    </h2>
                </div>
            </section>

            <section class="h-screen w-full relative bg-brand-dark overflow-hidden" id="section-values" aria-label="Our Core Values">
                <div class="h-full flex w-[400vw]" id="values-track">
                    <div class="w-screen h-full flex flex-col justify-center px-6 md:px-20 bg-[#B8003D]/95 backdrop-blur-md text-brand-light cursor-scroll hover-trigger">
                        <h3 class="font-display font-black uppercase overflow-hidden fluid-value">
                            <span class="value-title">Fearless.</span>
                        </h3>
                        <p class="text-xl md:text-4xl font-light mt-4 max-w-2xl opacity-0 value-desc">We innovate instead of being confined, jumping off cliffs to see the water below.</p>
                    </div>
                    <div class="w-screen h-full flex flex-col justify-center px-6 md:px-20 bg-[#003CBB]/95 backdrop-blur-md text-brand-light cursor-scroll hover-trigger">
                        <h3 class="font-display font-black uppercase overflow-hidden fluid-value">
                            <span class="value-title">Crafted.</span>
                        </h3>
                        <p class="text-xl md:text-4xl font-light mt-4 max-w-2xl opacity-0 value-desc">Every pixel, every vertex, meticulously positioned for the user experience.</p>
                    </div>
                    <div class="w-screen h-full flex flex-col justify-center px-6 md:px-20 bg-[#B83300]/95 backdrop-blur-md text-brand-light cursor-scroll hover-trigger">
                        <h3 class="font-display font-black uppercase overflow-hidden fluid-value">
                            <span class="value-title">Kinetic.</span>
                        </h3>
                        <p class="text-xl md:text-4xl font-light mt-4 max-w-2xl opacity-0 value-desc">Motion is the status quo. Static blocks of text simply don't work anymore.</p>
                    </div>
                    <div class="w-screen h-full flex flex-col justify-center px-6 md:px-20 bg-[#dfff00]/95 backdrop-blur-md text-brand-dark cursor-scroll hover-trigger">
                        <h3 class="font-display font-black uppercase overflow-hidden fluid-value">
                            <span class="value-title text-brand-dark">Immersive.</span>
                        </h3>
                        <p class="text-xl md:text-4xl font-bold mt-4 max-w-2xl opacity-0 value-desc text-brand-dark">We don't just build pages. We build unforgettable digital ecosystems.</p>
                    </div>
                </div>
            </section>

            <section class="h-[150vh] w-full relative overflow-hidden mix-blend-difference" id="section-marquee" aria-hidden="true">
                <div class="sticky top-0 h-screen flex flex-col justify-center">
                    <div class="marquee-container whitespace-nowrap overflow-hidden -rotate-2 scale-110">
                        <h2 class="font-display text-[26vw] sm:text-[20vw] md:text-[15vw] font-black uppercase text-outline marquee-text leading-none z-10 relative">
                            EXPERIENCE DESIGN EXPERIENCE DESIGN EXPERIENCE
                        </h2>
                        <h2 class="font-display text-[26vw] sm:text-[20vw] md:text-[15vw] font-black uppercase text-brand-light marquee-text-reverse leading-none z-10 relative">
                            FUTURE VISION FUTURE VISION FUTURE VISION FUTURE
                        </h2>
                        <h2 class="font-display text-[26vw] sm:text-[20vw] md:text-[15vw] font-black uppercase text-outline marquee-text leading-none z-10 relative">
                            DIGITAL IMMERSION DIGITAL IMMERSION DIGITAL
                        </h2>
                    </div>
                </div>
            </section>

            <section class="h-screen w-full flex flex-col justify-center items-center relative bg-brand-accent text-brand-dark px-6" id="section-contact">
                <div class="flex flex-col items-center justify-center w-full z-10 text-center">
                    <h2 class="font-display text-[10vw] md:text-[6vw] font-bold uppercase split-target text-brand-dark leading-none mb-8 text-solid-shadow" style="text-shadow: 0 4px 15px rgba(5,5,5,0.15);">
                        Ready to start?
                    </h2>
                    <a href="mailto:ledinhvuong2013@gmail.com" class="magnetic-btn flex items-center gap-3 text-lg md:text-3xl font-bold text-brand-dark border-b-4 border-transparent hover:border-brand-dark py-4 transition-all duration-300 min-h-[44px]">
                        <svg class="w-6 h-6 md:w-10 md:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        ledinhvuong2013@gmail.com
                    </a>
                </div>
                
                <footer class="absolute bottom-0 left-0 w-full p-6 md:p-10 flex flex-col md:flex-row justify-between items-center text-[10px] md:text-sm font-bold uppercase tracking-widest z-10 border-t-2 border-brand-dark bg-brand-dark text-brand-light">
                    <span class="mb-2 md:mb-0">Templepear ¬© 2026.</span>
                    <span class="text-brand-accent">All rights reserved.</span>
                </footer>
            </section>

        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js" defer></script>

    <script>
        window.addEventListener('load', () => {
            gsap.registerPlugin(ScrollTrigger);

            function splitText(selector) {
                document.querySelectorAll(selector).forEach(el => {
                    const text = el.innerText.trim();
                    el.setAttribute('aria-label', text);
                    el.innerHTML = text.split('').map(char => {
                        if (char === ' ') return `<span aria-hidden="true" class="char" style="width: 0.3em;">&nbsp;</span>`;
                        return `<span aria-hidden="true" class="char">${char}</span>`;
                    }).join('');
                });
            }

            window.scrollTo(0, 0);

            const isTouchDevice = () => {
                return (('ontouchstart' in window) ||
                    (navigator.maxTouchPoints > 0) ||
                    (navigator.msMaxTouchPoints > 0));
            };
            
            const isMobileDevice = isTouchDevice();

            let loadProgress = 0;
            const loaderPath = document.getElementById('pear-loader-path');
            const pathLength = loaderPath.getTotalLength();
            
            loaderPath.style.strokeDasharray = pathLength;
            loaderPath.style.strokeDashoffset = pathLength;

            const loadInterval = setInterval(() => {
                loadProgress += Math.random() * 12; 
                if (loadProgress >= 100) {
                    loadProgress = 100;
                    clearInterval(loadInterval);
                    
                    gsap.to(loaderPath, { 
                        fill: '#dfff00', 
                        duration: 0.4, 
                        ease: "power2.out",
                        onComplete: initApp 
                    });
                }
                loaderPath.style.strokeDashoffset = pathLength - (loadProgress / 100) * pathLength;
            }, 80);

            function initApp() {
                initSmoothScroll();
                initThreeJS();
                initScrollytelling();
                initCustomCursor();

                gsap.set(".char", { yPercent: 105, opacity: 0 });

                gsap.to('#loader', {
                    yPercent: -100,
                    duration: 1.2,
                    ease: "power4.inOut",
                    onComplete: () => {
                        const loader = document.getElementById('loader');
                        loader.style.display = 'none';
                        loader.setAttribute('aria-busy', 'false');
                    }
                });

                gsap.to("#section-hero .char", {
                    yPercent: 0,
                    opacity: 1,
                    stagger: 0.04,
                    duration: 1.5,
                    ease: "expo.out",
                    delay: 0.4
                });

                if (typeof pearGroup !== 'undefined') {
                    gsap.from(pearGroup.position, {
                        y: -5,
                        duration: 2.5,
                        ease: "power3.out",
                        delay: 0.2
                    });
                }
            }

            let lenis;
            const clock = new THREE.Clock(); // Initialized early for unified loop
            
            function initSmoothScroll() {
                lenis = new Lenis({
                    duration: 1.5,
                    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), 
                    direction: 'vertical',
                    gestureDirection: 'vertical',
                    smooth: true,
                    mouseMultiplier: 1,
                    smoothTouch: isMobileDevice,
                    touchMultiplier: 2,
                });

                lenis.on('scroll', ScrollTrigger.update);

                // PERFORMANCE FIX: Unified Tick Loop. 
                // Removed the separate requestAnimationFrame loop for Three.js 
                // and integrated everything into GSAP's optimized ticker.
                // Removed lagSmoothing(0) which blocks main thread recovery.
                gsap.ticker.add((time) => {
                    lenis.raf(time * 1000);
                    
                    // Unified ThreeJS Render integration
                    if (renderer && scene && camera) {
                        const elapsedTime = clock.getElapsedTime();
                        targetX = mouseX * 0.5;
                        targetY = mouseY * 0.5;

                        if (pearGroup) {
                            pearGroup.position.y += Math.sin(elapsedTime * 1.5) * 0.002;
                            pearGroup.rotation.x += (targetY * 0.5 - pearGroup.rotation.x) * 0.05;
                            pearGroup.rotation.y += 0.005 + (targetX * 0.5 - (pearGroup.rotation.y % (Math.PI*2))) * 0.01;
                        }

                        if(particles) {
                            particles.rotation.y = elapsedTime * 0.035 + (mouseX * 0.1);
                            particles.rotation.x = (mouseY * 0.1);
                        }

                        if (mouseLight) {
                            mouseLight.position.x += (mouseX * 5 - mouseLight.position.x) * 0.1;
                            mouseLight.position.y += (mouseY * 5 - mouseLight.position.y) * 0.1;
                        }

                        renderer.render(scene, camera);
                    }
                });
            }

            let scene, camera, renderer, pearGroup, pearMat, pearWireMat, mouseLight;
            let particles, particleMat;
            let mouseX = 0, mouseY = 0;
            let targetX = 0, targetY = 0;

            function initThreeJS() {
                const container = document.getElementById('webgl-container');
                
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x050505, 0.02);

                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = isMobileDevice ? 12 : 8;

                renderer = new THREE.WebGLRenderer({ alpha: true, antialias: !isMobileDevice }); // Disable antialias on mobile for performance
                renderer.setSize(window.innerWidth, window.innerHeight);
                // PERFORMANCE FIX: Cap pixel ratio to 1.5. Visual difference is imperceptible but saves millions of fragment calculations.
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
                container.appendChild(renderer.domElement);

                // PERFORMANCE FIX: Drastically reduced particle count. 8000 points was overwhelming the CPU geometry pipeline.
                const particleCount = isMobileDevice ? 800 : 3500;
                const particleGeo = new THREE.BufferGeometry();
                const posArray = new Float32Array(particleCount * 3);
                
                for(let i=0; i < particleCount * 3; i++) {
                    posArray[i] = (Math.random() - 0.5) * 45;
                }
                particleGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

                const canvas = document.createElement('canvas');
                canvas.width = 64;
                canvas.height = 64;
                const ctx = canvas.getContext('2d');
                const gradient = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
                gradient.addColorStop(0, 'rgba(255,255,255,1)');
                gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)');
                gradient.addColorStop(0.5, 'rgba(255,255,255,0.2)');
                gradient.addColorStop(1, 'rgba(255,255,255,0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 64, 64);
                const sprite = new THREE.CanvasTexture(canvas);

                particleMat = new THREE.PointsMaterial({
                    size: 0.22,
                    map: sprite,
                    transparent: true,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false,
                    color: 0xdfff00,
                    opacity: 0.65
                });

                particles = new THREE.Points(particleGeo, particleMat);
                scene.add(particles);

                pearGroup = new THREE.Group();
                scene.add(pearGroup);

                const profilePoints = [
                    new THREE.Vector2(0.001, -1.75), 
                    new THREE.Vector2(0.4, -1.75),   
                    new THREE.Vector2(1.15, -1.1),   
                    new THREE.Vector2(1.15, -0.3),   
                    new THREE.Vector2(0.75, 0.4),    
                    new THREE.Vector2(0.65, 1.0),    
                    new THREE.Vector2(0.35, 1.5),    
                    new THREE.Vector2(0.001, 1.6)    
                ];
                const curve = new THREE.SplineCurve(profilePoints);
                const points = curve.getPoints(100);
                
                // PERFORMANCE FIX: Reduced Lathe segments from 128 to 64. Visually identical, halves vertex count.
                const pearGeo = new THREE.LatheGeometry(points, 64);
                pearGeo.computeVertexNormals();

                // PERFORMANCE FIX: Changed from MeshPhysicalMaterial (very expensive clearcoat shader) to MeshStandardMaterial.
                pearMat = new THREE.MeshStandardMaterial({
                    color: 0xdfff00,
                    metalness: 0.2,
                    roughness: 0.3, 
                    transparent: true,
                    opacity: 1
                });

                pearWireMat = new THREE.MeshStandardMaterial({
                    color: 0x00ff80, 
                    wireframe: true,
                    transparent: true,
                    opacity: 0
                });

                const pearMesh = new THREE.Mesh(pearGeo, pearMat);
                pearGroup.add(pearMesh);

                const wire = pearMesh.clone();
                wire.material = pearWireMat;
                wire.scale.set(1.002, 1.002, 1.002);
                pearGroup.add(wire);

                const stemGeo = new THREE.CylinderGeometry(0.03, 0.06, 0.6, 16); // reduced stem segments
                stemGeo.translate(0, 0.3, 0); 
                const stemMat = new THREE.MeshStandardMaterial({
                    color: 0x3d2817, 
                    roughness: 0.9,
                    metalness: 0.1
                });
                const stem = new THREE.Mesh(stemGeo, stemMat);
                stem.position.set(0, 1.55, 0); 
                stem.rotation.z = -0.15;
                stem.rotation.x = 0.1;
                pearGroup.add(stem);

                const pearScale = isMobileDevice ? 0.55 : 0.8;
                pearGroup.scale.set(pearScale, pearScale, pearScale);

                if (isMobileDevice) {
                    pearGroup.position.y = -1.5;
                }

                const ambient = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
                scene.add(ambient);

                const dirLight1 = new THREE.DirectionalLight(0x00ffff, 2.0);
                dirLight1.position.set(5, 5, 5);
                scene.add(dirLight1);

                const dirLight2 = new THREE.DirectionalLight(0xff00ff, 2.0);
                dirLight2.position.set(-5, -5, 5);
                scene.add(dirLight2);

                mouseLight = new THREE.PointLight(0xffffff, 3.5, 12);
                mouseLight.position.set(0, 0, 5);
                scene.add(mouseLight);

                // PERFORMANCE FIX: Debounced Resize Listener to prevent matrix recalculation thrashing
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        camera.aspect = window.innerWidth / window.innerHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(window.innerWidth, window.innerHeight);
                        camera.position.z = window.innerWidth < 768 ? 12 : 8;
                        ScrollTrigger.refresh();
                    }, 150);
                });

                document.addEventListener('mousemove', (e) => {
                    mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
                });
            }

            function initScrollytelling() {
                splitText('.split-target');

                const tl3D = gsap.timeline({
                    scrollTrigger: {
                        trigger: "#smooth-wrapper",
                        start: "top top",
                        end: "bottom bottom",
                        scrub: 1, 
                    }
                });

                const getOffX = () => window.innerWidth < 768 ? 0 : 1.65;
                const getHeroY = () => window.innerWidth < 768 ? -1.8 : -0.5;

                tl3D.to(pearGroup.position, { x: getOffX(), y: getHeroY(), z: 2, ease: "power1.inOut" }, 0);
                tl3D.to(pearGroup.rotation, { y: Math.PI * 2, z: 0.3, ease: "power1.inOut" }, 0);
                tl3D.to(pearMat.color, { r: 1, g: 0.2, b: 0.5, ease: "none" }, 0); 
                tl3D.to(particleMat.color, { r: 1, g: 0.2, b: 0.5, ease: "none" }, 0);

                tl3D.to(pearGroup.position, { x: -getOffX(), y: 0.5, z: 1, ease: "power1.inOut" }, 1);
                tl3D.to(pearGroup.rotation, { y: Math.PI * 4, x: 0.5, z: -0.2, ease: "power1.inOut" }, 1);
                tl3D.to(pearMat, { opacity: 0, roughness: 0.8 }, 1);
                tl3D.to(pearWireMat, { opacity: 1 }, 1);
                tl3D.to(particleMat.color, { r: 0, g: 1, b: 0.5, ease: "none" }, 1); 

                tl3D.to(pearGroup.position, { x: 0, y: 0, z: -2, ease: "power1.inOut" }, 2);
                tl3D.to(pearGroup.rotation, { y: Math.PI * 6, x: 0, z: 0, ease: "power1.inOut" }, 2);
                tl3D.to(pearMat, { opacity: 1, roughness: 0.3 }, 2);
                tl3D.to(pearWireMat, { opacity: 0 }, 2);
                tl3D.to(pearMat.color, { r: 1, g: 1, b: 1, ease: "none" }, 2); 
                
                tl3D.to(particleMat, { opacity: 0, ease: "power2.out" }, 2);

                tl3D.to(pearGroup.position, { x: 0, y: 0, z: -5, ease: "power1.inOut" }, 3);
                tl3D.to(pearMat.color, { r: 0.1, g: 0.1, b: 1, ease: "none" }, 3); 

                tl3D.to(pearGroup.position, { x: 0, y: -1, z: 6, ease: "power2.in" }, 4); 
                tl3D.to(pearMat.color, { r: 0.9, g: 0.9, b: 0.1, ease: "none" }, 4); 

                const track = document.getElementById('values-track');
                gsap.to(track, {
                    xPercent: -75,
                    ease: "none",
                    scrollTrigger: {
                        trigger: "#section-values",
                        start: "top top",
                        end: "+=300%",
                        pin: true,
                        scrub: 1
                    }
                });
                
                gsap.to(".section-2-text .char", {
                    scrollTrigger: { trigger: "#section-about", start: "top 70%", end: "top 30%", scrub: 1 },
                    yPercent: 0, opacity: 1, stagger: 0.05, ease: "power3.out"
                });
                gsap.to(".section-2-fade", {
                    scrollTrigger: { trigger: "#section-about", start: "top 60%", end: "top 20%", scrub: 1 },
                    opacity: 1, y: 0, ease: "power2.out"
                });

                gsap.to(".section-3-text .char", {
                    scrollTrigger: { trigger: "#section-services", start: "top 70%", end: "top 30%", scrub: 1 },
                    yPercent: 0, opacity: 1, stagger: 0.05, ease: "power3.out"
                });

                gsap.to(".marquee-text", {
                    scrollTrigger: { trigger: "#section-marquee", start: "top bottom", end: "bottom top", scrub: 1 },
                    xPercent: -20, ease: "none"
                });
                gsap.to(".marquee-text-reverse", {
                    scrollTrigger: { trigger: "#section-marquee", start: "top bottom", end: "bottom top", scrub: 1 },
                    xPercent: 20, ease: "none"
                });

                gsap.to("#section-contact .char", {
                    scrollTrigger: { trigger: "#section-contact", start: "top 85%", end: "center center", scrub: 1 },
                    yPercent: 0, opacity: 1, stagger: 0.05, scale: 1, ease: "back.out(1.5)"
                });
            }

            function initCustomCursor() {
                const cursor = document.getElementById('cursor');

                if (isMobileDevice) {
                    cursor.style.display = 'none';
                    return;
                }

                const style = document.createElement('style');
                style.innerHTML = `body, a, button, .cursor-hover, .cursor-scroll, .magnetic-btn { cursor: none !important; }`;
                document.head.appendChild(style);

                // PERFORMANCE FIX: Replaced custom string concatenation ticker with highly optimized GSAP quickTo.
                // This prevents extreme DOM layout thrashing on every single mouse coordinate change.
                gsap.set(cursor, {xPercent: -50, yPercent: -50});
                
                const xTo = gsap.quickTo(cursor, "x", {duration: 0.15, ease: "power3"});
                const yTo = gsap.quickTo(cursor, "y", {duration: 0.15, ease: "power3"});

                document.addEventListener('mousemove', (e) => {
                    xTo(e.clientX);
                    yTo(e.clientY);
                });

                const hoverElements = document.querySelectorAll('.cursor-hover, a, button, [tabindex]');
                hoverElements.forEach(el => {
                    el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
                    el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
                });

                const scrollElements = document.querySelectorAll('.cursor-scroll');
                scrollElements.forEach(el => {
                    el.addEventListener('mouseenter', () => cursor.classList.add('scroll-state'));
                    el.addEventListener('mouseleave', () => cursor.classList.remove('scroll-state'));
                });

                const magneticBtns = document.querySelectorAll('.magnetic-btn');
                magneticBtns.forEach(btn => {
                    btn.addEventListener('mousemove', (e) => {
                        const rect = btn.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width / 2;
                        const y = e.clientY - rect.top - rect.height / 2;
                        gsap.to(btn, { x: x * 0.3, y: y * 0.3, duration: 0.3, ease: 'power2.out' });
                    });
                    btn.addEventListener('mouseleave', () => {
                        gsap.to(btn, { x: 0, y: 0, duration: 0.7, ease: 'elastic.out(1, 0.3)' });
                        cursor.classList.remove('hover');
                    });
                    btn.addEventListener('mouseenter', () => cursor.classList.add('hover'));
                });
            }
        });
    </script>
</body>
</html>
